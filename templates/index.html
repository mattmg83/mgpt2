<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathieuGPT Chat v2</title>
    <link rel=”stylesheet” href=”https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css”rel=”nofollow” integrity=”sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I” crossorigin=”anonymous”><style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            width: 100%;
            max-width: 600px;
            border: 1px solid #ccc;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        p {
            text-align: justify;
        }
        form {
            margin-bottom: 20px;
        }
        input[type="text"] {
            width: 98%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        button {
            width: fit-content;
            background-color: #4CAF50;
            color: white;
            padding-left: 17px;
            padding-right: 17px;
            padding-top: 10px;
            padding-bottom: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        button:hover {
            background-color: #45a049;
        }
        #refresh_button {
            background-color: grey;
        }
        #response {
            margin-bottom: 10px;
            font-style: italic;
        }
        #chat_history {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }
        #chat_history li {
            margin-bottom: 10px;
        }
        .message-wrapper {
        display: flex;
        flex-direction: column;
        margin-bottom: 1em;
      }

      .message-label {
        font-weight: bold;
        margin-bottom: 0.25em;
      }

      .message {
        white-space: pre-wrap;
      }
    </style>
</head>
<body>
    <div class="container">
        <h1>MathieuGPT v2</h1>
        <p>Welcome to MathieuGPT, an AI language model that responds with a French accent and occasional sarcasm. The chatbot can keep track of context and answer follow up questions to earlier prompts. To start a new chat entirely, refresh the page</p>
        <div id="response"></div>
        <form onsubmit="event.preventDefault(); sendMessage();">
            <input type="text" id="user_input" placeholder="Type your message here...">
            <button type="submit" id="send_button">Send</button>
            <button type="button" id="refresh_button" onclick="refreshPage()">New Chat</button>
        </form>
        <div id="chat_history"></div>
    </div>
        <script>
      let messages = [
        {
          role: "system",
          content:
            "you are an assistant with a french accent, you occasionally swear in english and often respond sarcastically. You dislike consultants and corporate buzzwords but love analogies. Your beliefs in general are considered liberal, your philosophy is mostly stoic, your beliefs on strategy and innovation are inspired by startups rather than large companies. In terms of work culture you generally advocate for a servant leadership style of management. You are a believer of behavioral economics against classical economic theories. Politically your views are socially progressive but fiscally conservative. You like underground hip-hop and rap from the mid 90's (love MF Doom). You love soccer and support PSG (Paris Saint Germain), your favorite player ever is Javier Pastore. Your preferred art form is street photography",
        },
      ];

      async function sendChat(content) {
        const response = await fetch("/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ content, messages }),
        });

        if (response.ok) {
          const data = await response.json();
          const chatResponse = data.response;
          messages.push({ role: "assistant", content: chatResponse });
          return chatResponse;
        } else {
          throw new Error("Failed to fetch chat response");
        }
      }

      function displayMessage(role, content) {
        const chatHistory = document.getElementById("chat_history");
        const messageWrapper = document.createElement("div");
        messageWrapper.classList.add("message-wrapper");

        const messageLabel = document.createElement("div");
        messageLabel.classList.add("message-label");
        messageLabel.textContent = role === "user" ? "user: " : "MathieuGPT: ";
        messageWrapper.appendChild(messageLabel);

        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message");
        messageDiv.innerHTML = content.replace(/\n/g, "<br/>");
        messageWrapper.appendChild(messageDiv);

        chatHistory.appendChild(messageWrapper);
      }

      function handleSendButtonClick() {
        const userInput = document.getElementById("user_input");
        const content = userInput.value;
        userInput.value = "";

        displayMessage("user", content);
        sendChat(content)
          .then((response) => {
            displayMessage("assistant", response);
          })
          .catch((error) => {
            console.error("Error: ", error);
          });
      }
        
      function refreshPage() {
        location.reload();
      }
            
      document.getElementById("send_button").addEventListener("click", handleSendButtonClick);
    </script>


</body>
</html>
